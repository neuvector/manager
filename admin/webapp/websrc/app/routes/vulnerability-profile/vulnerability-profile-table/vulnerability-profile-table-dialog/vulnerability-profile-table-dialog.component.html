<div class="d-flex flex-row align-items-center justify-content-between">
  <h1 class="h4">
    {{
      edit
        ? ('cveProfile.EDIT_CVE_PROFILE' | translate)
        : ('cveProfile.ADD_CVE_PROFILE' | translate)
    }}
  </h1>
  <button (click)="onNoClick()" aria-label="Close dialog" mat-icon-button>
    <i class="eos-icons">close</i>
  </button>
</div>
<form [formGroup]="form">
  <section class="ml-2 d-flex flex-row">
    <div>
      <mat-radio-group
        class="vertical-radio-group"
        formControlName="selectedFilterType">
        <mat-radio-button
          value="0"
          style="margin-top: 12px; margin-bottom: 30px"
          (click)="changeView(0)"
          [checked]="form.get('selectedFilterType')!.value === View.NAME">
        </mat-radio-button>
        <mat-radio-button
          value="1"
          style="margin-top: 12px; margin-bottom: 30px"
          (click)="changeView(1)"
          [checked]="form.get('selectedFilterType')!.value === View.WITH_FIX">
        </mat-radio-button>
        <mat-radio-button
          value="2"
          style="margin-top: 12px; margin-bottom: 30px"
          (click)="changeView(2)"
          [checked]="
            form.get('selectedFilterType')!.value === View.WITHOUT_FIX
          ">
        </mat-radio-button>
      </mat-radio-group>
    </div>
    <div>
      <div>
        <ng-container class="d-flex flex-row">
          <label for="name" class="mr-2">{{
            'cveProfile.NAME' | translate
          }}</label>
          <mat-form-field style="width: 250px">
            <input
              formControlName="name"
              id="name"
              matInput
              [attr.maxlength]="'general.FILTER_MAX_LEN' | translate" />
            <mat-hint>{{ 'cveProfile.hint.NAME' | translate }}</mat-hint>
            <mat-error *ngIf="form.controls.name.hasError('required')">
              {{ 'setting.webhook.NAME_EMPTY' | translate }}
            </mat-error>
          </mat-form-field>
        </ng-container>
      </div>
      <div>
        <ng-container class="d-flex flex-row">
          <label for="withFix" class="mr-2">{{
            'cveProfile.REPORTED_WITHIN' | translate
          }}</label>
          <mat-form-field style="width: 100px">
            <input
              formControlName="withFix"
              id="withFix"
              matInput
              (keydown)="onDaysInput($event)"
              (paste)="onDaysInput($event)"
              [attr.maxlength]="5" />
            <mat-error *ngIf="form.controls.withFix.hasError('required')">
              {{ 'policy.toolBar.ID_VAL_ERR' | translate }}
            </mat-error>
            <mat-error
              *ngIf="
                form.controls.withFix.hasError('pattern') ||
                form.controls.withFix.hasError('max')
              ">
              {{ 'admissionControl.msg.NOT_NUMBER_ERR' | translate }}
            </mat-error>
          </mat-form-field>
          <label for="withFix" class="ml-2">{{
            'cveProfile.gridHeader.DAYS_SUFFIX' | translate
          }}</label>
        </ng-container>
      </div>
      <div>
        <ng-container class="d-flex flex-row">
          <label for="withoutFix" class="mr-2">{{
            'cveProfile.REPORTED_WITHIN' | translate
          }}</label>
          <mat-form-field style="width: 100px">
            <input
              formControlName="withoutFix"
              id="withoutFix"
              matInput
              (keydown)="onDaysInput($event)"
              (paste)="onDaysInput($event)"
              [attr.maxlength]="5" />
            <mat-error *ngIf="form.controls.withoutFix.hasError('required')">
              {{ 'policy.toolBar.ID_VAL_ERR' | translate }}
            </mat-error>
            <mat-error
              *ngIf="
                form.controls.withoutFix.hasError('pattern') ||
                form.controls.withoutFix.hasError('max')
              ">
              {{ 'admissionControl.msg.NOT_NUMBER_ERR' | translate }}
            </mat-error>
          </mat-form-field>
          <label for="withFix" class="ml-2">{{
            'cveProfile.gridHeader.DAYS_SUFFIX_WITHOUT_FIX' | translate
          }}</label>
        </ng-container>
      </div>
    </div>
  </section>
  <section class="row mx-0 align-items-center">
    <mat-form-field class="col-12">
      <mat-label>{{ 'cveProfile.gridHeader.COMMENT' | translate }}</mat-label>
      <input
        formControlName="comment"
        matInput
        placeholder="Comment..."
        [attr.maxlength]="'general.FILTER_MAX_LEN' | translate" />
    </mat-form-field>
    <div class="col-12 d-flex flex-row align-items-center">
      <div class="mr-4">
        <span class="d-block font-weight-bold">{{
          'cveProfile.gridHeader.IMAGES' | translate
        }}</span>
        <span class="d-block">{{
          'group.editGroup.CONDITION_HINT' | translate
        }}</span>
      </div>
      <label class="sr-only" for="imagesInput">Images</label>
      <mat-form-field style="width: 60%">
        <mat-chip-grid #imageChipList formControlName="images" id="imagesInput">
          <mat-chip-row
            (removed)="removeImage(image)"
            *ngFor="let image of form.controls.images.value">
            {{ image }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip-row>
          <input
            (matChipInputTokenEnd)="addImage($event)"
            [matChipInputAddOnBlur]="addOnBlur"
            [matChipInputFor]="imageChipList"
            [placeholder]="'cveProfile.IMAGES_PLACEHOLDER' | translate"
            [attr.maxlength]="'general.FILTER_MAX_LEN' | translate"
            matInput />
        </mat-chip-grid>
        <mat-hint>{{ 'cveProfile.hint.IMAGE' | translate }}</mat-hint>
      </mat-form-field>
    </div>
    <div class="col-12 d-flex flex-row align-items-center">
      <div class="mr-4">
        <span class="d-block font-weight-bold">{{
          'cveProfile.gridHeader.DOMAINS' | translate
        }}</span>
        <span class="d-block">{{
          'group.editGroup.CONDITION_HINT' | translate
        }}</span>
      </div>
      <mat-form-field style="width: 60%">
        <mat-chip-grid #namespaceChipList aria-label="Namespace selection">
          <mat-chip-row
            (removed)="removeNamespace(domainChip)"
            *ngFor="let domainChip of domainChips">
            {{ domainChip }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip-row>
          <input
            #namespaceInput
            (matChipInputTokenEnd)="addNamespace($event)"
            [matChipInputAddOnBlur]="addOnBlur"
            [formControl]="namespaceCtrl"
            [matAutocomplete]="auto"
            [matChipInputFor]="namespaceChipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            [attr.maxlength]="'general.FILTER_MAX_LEN' | translate"
            [placeholder]="'ldap.ADD_DOMAIN' | translate" />
        </mat-chip-grid>
        <mat-autocomplete
          #auto="matAutocomplete"
          (optionActivated)="optionActivated($event)"
          (optionSelected)="selected($event)">
          <mat-option
            *ngFor="let domain of filteredDomains | async"
            [value]="domain">
            {{ domain }}
          </mat-option>
        </mat-autocomplete>
        <mat-hint>{{ 'cveProfile.hint.NAMESPACE' | translate }}</mat-hint>
      </mat-form-field>
    </div>
  </section>
</form>
<div class="d-inline-flex flex-row float-right">
  <button
    type="button"
    (click)="onNoClick()"
    class="mr-2"
    color="warn"
    mat-button>
    {{ 'cveProfile.CANCEL' | translate }}
  </button>
  <button
    type="submit"
    (click)="confirm()"
    [disabled]="!form.valid"
    color="primary"
    mat-raised-button>
    {{
      edit ? ('cveProfile.UPDATE' | translate) : ('cveProfile.ADD' | translate)
    }}
  </button>
</div>
